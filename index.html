<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Carrier Report</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        /* Custom styles if needed, or to ensure Telegram WebApp specific styles */
        body {
            font-family: 'Inter', sans-serif; /* Using Inter font as per general guidelines */
            color: var(--tg-theme-text-color, #000000); /* Telegram theme text color */
            background-color: var(--tg-theme-bg-color, #ffffff); /* Telegram theme background color */
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }
        .container {
            width: 100%;
            max-width: 600px; /* Max width for better readability on larger screens */
            margin: 0 auto;
            padding: 20px;
            box-sizing: border-box;
        }
        label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500; /* Medium font weight for labels */
        }
        input[type="text"], input[type="time"] { /* Removed input[type="file"] from this rule */
            width: 100%;
            padding: 0.75rem;
            margin-bottom: 1rem;
            border: 1px solid var(--tg-theme-hint-color, #cbd5e1); /* Border color from theme or fallback */
            border-radius: 0.375rem; /* Rounded corners */
            box-sizing: border-box;
            background-color: var(--tg-theme-secondary-bg-color, #f9fafb); /* Input background */
            color: var(--tg-theme-text-color, #000000);
        }
        /* Removed input[type="file"] specific style as it's removed */
        button {
            width: 100%;
            padding: 0.75rem 1.5rem;
            background-color: var(--tg-theme-button-color, #2563eb); /* Button color from theme or fallback */
            color: var(--tg-theme-button-text-color, #ffffff); /* Button text color from theme or fallback */
            border: none;
            border-radius: 0.375rem;
            font-weight: 600; /* Semi-bold for button text */
            cursor: pointer;
            transition: background-color 0.2s;
        }
        button:disabled {
            opacity: 0.7;
            cursor: not-allowed;
        }
        button:hover:not(:disabled) {
            opacity: 0.9;
        }
        .header {
            background-color: var(--tg-theme-secondary-bg-color, #f3f4f6);
            padding: 1rem 0;
            text-align: center;
            border-bottom: 1px solid var(--tg-theme-hint-color, #e5e7eb);
        }
        .header h1 {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--tg-theme-text-color, #1f2937);
        }
        .footer {
            text-align: center;
            padding: 1rem;
            margin-top: auto;
            font-size: 0.875rem;
            color: var(--tg-theme-hint-color, #6b7280);
        }
        /* Responsive adjustments */
        @media (max-width: 640px) {
            .container {
                padding: 15px;
            }
            .header h1 {
                font-size: 1.25rem;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>Carrier Report Form</h1>
    </div>

    <div class="container">
        <form id="reportForm">
            <div>
                <label for="check_in_time">Check-IN Time:</label>
                <input type="time" id="check_in_time" name="check_in_time" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5" required>
            </div>

            <div>
                <label for="door_number" class="mt-4">Door #:</label>
                <input type="text" id="door_number" name="door_number" placeholder="e.g., D12 or 105" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5" required>
            </div>

            <div>
                <label for="checkout_time" class="mt-4">Check-OUT Time:</label>
                <input type="time" id="checkout_time" name="checkout_time" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5" required>
            </div>

            <button type="submit" id="submitButton" class="mt-6 w-full text-white bg-blue-600 hover:bg-blue-700 focus:ring-4 focus:outline-none focus:ring-blue-300 font-medium rounded-lg text-sm px-5 py-2.5 text-center">
                Submit Text Details
            </button>
        </form>
    </div>

    <div class="footer">
        <p id="statusMessage"></p>
        <p>&copy; <span id="currentYear"></span> Carrier Bot</p>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        console.log("Telegram WebApp object (tg):", tg); // DEBUG: Check tg object

        document.addEventListener('DOMContentLoaded', function () {
            console.log("DOM fully loaded and parsed"); // DEBUG
            try {
                tg.ready();
                console.log("Telegram WebApp SDK 'ready' called."); // DEBUG
                tg.expand(); 
                console.log("Telegram WebApp SDK 'expand' called."); // DEBUG
            } catch (e) {
                console.error("Error during Telegram WebApp SDK initialization:", e); // DEBUG
            }


            const form = document.getElementById('reportForm');
            const submitButton = document.getElementById('submitButton'); 
            const statusMessage = document.getElementById('statusMessage');
            
            document.getElementById('currentYear').textContent = new Date().getFullYear();


            form.addEventListener('submit', async function (event) {
                event.preventDefault();
                console.log("Form submission initiated."); // DEBUG
                statusMessage.textContent = 'Submitting details...';
                submitButton.disabled = true; 
                try {
                    tg.MainButton.showProgress(false); 
                    console.log("Telegram MainButton progress shown."); // DEBUG
                } catch(e) {
                    console.error("Error showing MainButton progress:", e); // DEBUG
                }


                const checkInTime = document.getElementById('check_in_time').value;
                const doorNumber = document.getElementById('door_number').value;
                const checkoutTime = document.getElementById('checkout_time').value;
                
                const reportData = {
                    check_in_time: checkInTime,
                    door_number: doorNumber,
                    checkout_time: checkoutTime
                };

                const jsonDataString = JSON.stringify(reportData);
                console.log("Data to be sent (text only - length):", jsonDataString.length, reportData); // DEBUG
                alert("Попытка отправки данных боту! Проверьте консоль бота.\nData: " + jsonDataString); // DEBUG ALERT

                try {
                    console.log("Attempting to send data via tg.sendData..."); // DEBUG
                    console.log("WebApp fully initialized check:", tg.isVersionAtLeast('6.1')); // DEBUG: Check API version
                    console.log("User data from WebApp (initDataUnsafe):", tg.initDataUnsafe?.user); // DEBUG: Check user data
                    
                    tg.sendData(jsonDataString);
                    
                    console.log("Data supposedly sent via tg.sendData."); // DEBUG
                    alert("Данные якобы отправлены! Проверьте консоль бота."); // DEBUG ALERT
                    statusMessage.textContent = 'Report details submitted! Bot will ask for photo next.'; 
                                        // This message might not be visible for long if app closes
                } catch (error) {
                    console.error("Error sending data via tg.sendData:", error); // DEBUG
                    alert("Ошибка отправки данных через tg.sendData: " + error.message); // DEBUG ALERT
                    statusMessage.textContent = 'Error submitting details. Please try again. Details: ' + error.message;
                    submitButton.disabled = false; 
                } finally {
                    try {
                        tg.MainButton.hideProgress();
                        console.log("Telegram MainButton progress hidden."); // DEBUG
                    } catch(e) {
                        console.error("Error hiding MainButton progress:", e); // DEBUG
                    }
                }
            });
            
            try {
                tg.MainButton.setText('Submit Text Details'); 
                tg.MainButton.onClick(function() {
                    console.log("Telegram MainButton clicked."); // DEBUG
                    form.requestSubmit(); 
                });

                form.addEventListener('input', function() {
                    if (form.checkValidity()) {
                        tg.MainButton.show();
                        console.log("Telegram MainButton shown (form valid)."); // DEBUG
                    } else {
                        tg.MainButton.hide();
                        console.log("Telegram MainButton hidden (form invalid)."); // DEBUG
                    }
                });
                if (form.checkValidity()) {
                     tg.MainButton.show();
                     console.log("Telegram MainButton shown (initial check)."); // DEBUG
                } else {
                     tg.MainButton.hide();
                     console.log("Telegram MainButton hidden (initial check)."); // DEBUG
                }
            } catch (e) {
                console.error("Error setting up Telegram MainButton:", e); // DEBUG
            }
        });
    </script>
</body>
</html>
